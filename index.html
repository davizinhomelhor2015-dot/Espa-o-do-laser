<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Balc√£o para o Cidad√£o ‚Äî UCSal</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,700;1,9..40,400&family=Playfair+Display:ital,wght@0,700;0,900;1,400;1,600&display=swap" rel="stylesheet">
<style>
:root{
  --cy:#22d3ee;--pu:#818cf8;--pk:#f472b6;
  --bg1:#030712;--bg2:#0c1445;
  --tx:#f0f9ff;--mu:#94a3b8;
  --card:rgba(15,23,42,0.72);--mw:1200px;--sp:.25s;
  --border:rgba(255,255,255,0.06);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',system-ui,sans-serif;background:radial-gradient(ellipse 900px 500px at 5% 0%,rgba(34,211,238,0.06),transparent),radial-gradient(ellipse 700px 600px at 95% 100%,rgba(129,140,248,0.07),transparent),linear-gradient(175deg,var(--bg1) 0%,var(--bg2) 100%);color:var(--tx);-webkit-font-smoothing:antialiased;overflow-y:auto;min-height:100vh;}
.gl,.gr{position:fixed;filter:blur(120px);opacity:.12;pointer-events:none;z-index:0;border-radius:50%;}
.gl{width:600px;height:600px;left:-10%;top:-10%;background:radial-gradient(circle,var(--cy),transparent 65%);}
.gr{width:500px;height:500px;right:-8%;bottom:-5%;background:radial-gradient(circle,var(--pu),transparent 65%);}
@keyframes fadeUp{from{opacity:0;transform:translateY(28px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.88)}to{opacity:1;transform:scale(1)}}
@keyframes shimmer{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes pulse-ring{0%,100%{transform:scale(1);opacity:.5}50%{transform:scale(1.06);opacity:.8}}
nav{position:fixed;top:12px;left:0;right:0;z-index:200;animation:fadeUp .5s ease both;}
.ni{margin:0 auto;max-width:var(--mw);display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 20px;border-radius:16px;background:rgba(3,7,18,0.82);backdrop-filter:blur(20px);border:1px solid rgba(34,211,238,0.1);box-shadow:0 8px 32px rgba(0,0,0,0.4);}
.nb{display:flex;gap:10px;align-items:center;font-weight:700;color:var(--cy);font-size:14px;text-decoration:none;}
.nb img{width:38px;height:38px;object-fit:contain;border-radius:9px;border:1px solid rgba(34,211,238,0.2);}
.nl{display:flex;gap:2px;list-style:none;align-items:center;}
.nl a{color:var(--mu);text-decoration:none;padding:7px 12px;border-radius:9px;font-weight:500;font-size:13px;transition:all var(--sp);}
.nl a:hover{background:rgba(255,255,255,0.06);color:var(--tx);}
.nbtn{background:linear-gradient(135deg,rgba(34,211,238,0.12),rgba(129,140,248,0.12))!important;color:var(--cy)!important;border:1px solid rgba(34,211,238,0.25)!important;border-radius:9px!important;font-weight:700!important;}
.nusr{display:flex;align-items:center;gap:8px;color:var(--mu);font-size:12.5px;font-weight:500;}
.navav{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--cy),var(--pu));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:#fff;flex-shrink:0;}
.hbg{display:none;width:40px;height:40px;border-radius:9px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--cy);align-items:center;justify-content:center;cursor:pointer;font-size:18px;}
.mob{position:fixed;top:72px;left:10px;right:10px;background:rgba(3,7,18,0.98);border:1px solid rgba(34,211,238,0.12);border-radius:14px;padding:10px;z-index:500;display:none;flex-direction:column;gap:4px;box-shadow:0 24px 60px rgba(0,0,0,0.7);}
.mob a{color:var(--tx);padding:11px 14px;border-radius:9px;text-decoration:none;font-weight:500;font-size:13.5px;display:block;transition:background var(--sp);}
.mob a:hover{background:rgba(34,211,238,0.07);}
.sw{max-width:var(--mw);margin:0 auto;padding:16px;position:relative;z-index:2;}
.hero{padding-top:110px;padding-bottom:52px;text-align:center;}
.hc{margin:0 auto;max-width:820px;padding:44px 36px;border-radius:28px;background:linear-gradient(160deg,rgba(15,23,42,0.8),rgba(3,7,18,0.9));border:1px solid rgba(34,211,238,0.12);backdrop-filter:blur(20px);box-shadow:0 40px 100px rgba(0,0,0,0.6);display:flex;flex-direction:column;gap:20px;align-items:center;animation:fadeUp .7s ease .1s both;}
.hlogo{width:160px;height:160px;border-radius:22px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(34,211,238,0.1),rgba(129,140,248,0.08));border:1px solid rgba(34,211,238,0.18);box-shadow:0 24px 60px rgba(0,0,0,0.5);animation:scaleIn .6s ease .3s both;position:relative;}
.hlogo::after{content:'';position:absolute;inset:-2px;border-radius:24px;background:linear-gradient(135deg,rgba(34,211,238,0.3),rgba(129,140,248,0.3));z-index:-1;filter:blur(6px);opacity:.5;animation:pulse-ring 3s ease-in-out infinite;}
.hlogo img{width:84%;height:84%;object-fit:contain;}
.hero-text{display:flex;flex-direction:column;gap:8px;align-items:center;}
h1{font-family:'Playfair Display',serif;font-size:42px;font-weight:900;letter-spacing:-.02em;background:linear-gradient(135deg,var(--cy) 0%,var(--pu) 50%,var(--pk) 100%);background-size:200% 200%;-webkit-background-clip:text;color:transparent;animation:shimmer 4s ease infinite;}
.sub{color:var(--mu);font-family:'Playfair Display',serif;font-style:italic;font-size:15.5px;opacity:.85;}
.sub+.sub{margin-top:2px;font-size:14px;opacity:.65;}
.ct{max-width:960px;margin:24px auto 90px;padding:0 14px;display:flex;flex-direction:column;gap:16px;}
.card{background:var(--card);border-radius:18px;padding:26px 28px;border:1px solid var(--border);backdrop-filter:blur(12px);transition:border-color var(--sp),box-shadow var(--sp),transform var(--sp);animation:fadeUp .6s ease both;}
.card:hover{border-color:rgba(34,211,238,0.14);box-shadow:0 12px 40px rgba(0,0,0,0.35);transform:translateY(-2px);}
.card h2{color:var(--cy);margin:0 0 14px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.14em;display:flex;align-items:center;gap:8px;}
.card h2::before{content:'';display:inline-block;width:20px;height:2px;background:var(--cy);border-radius:2px;}
.card-title{font-family:'Playfair Display',serif;font-size:26px;font-weight:700;color:var(--tx);margin-bottom:16px;letter-spacing:-.01em;}
.card p{color:var(--mu);line-height:1.75;margin:0;font-size:14.5px;}
.card p+p{margin-top:10px;}
.simg{width:100%;border-radius:12px;object-fit:cover;max-height:320px;margin-top:16px;border:1px solid var(--border);box-shadow:0 10px 40px rgba(0,0,0,0.3);}
.vg{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));margin-top:6px;}
.val{padding:18px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid var(--border);transition:border-color var(--sp),background var(--sp);position:relative;overflow:hidden;}
.val::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--cy),var(--pu));opacity:0;transition:opacity var(--sp);}
.val:hover{background:rgba(34,211,238,0.03);border-color:rgba(34,211,238,0.15);}
.val:hover::before{opacity:1;}
.val strong{color:var(--tx);font-size:13.5px;font-weight:700;display:block;margin-bottom:6px;}
.val p{margin:0!important;color:var(--mu);font-size:13px;line-height:1.6;}
.igc{display:flex;flex-direction:column;align-items:center;gap:14px;padding:28px;border-radius:18px;background:linear-gradient(135deg,rgba(147,51,234,0.06),rgba(236,72,153,0.05));border:1px solid rgba(236,72,153,0.14);}
.igc h2{color:var(--pk)!important;}
.igc h2::before{background:var(--pk)!important;}
.qrc{background:#fff;padding:8px;border-radius:12px;}
.igbtn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,#9333ea,#ec4899,#f97316);color:#fff;padding:11px 20px;border-radius:10px;text-decoration:none;font-weight:700;font-size:13.5px;transition:all var(--sp);}
.igbtn:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(147,51,234,0.35);}
footer{text-align:center;color:var(--mu);padding:30px 16px;border-top:1px solid var(--border);font-size:12.5px;}
.gpub{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:10px;margin-top:14px;}
.gpi{border-radius:12px;overflow:hidden;border:1px solid var(--border);cursor:pointer;}
.gpi img{width:100%;height:140px;object-fit:cover;display:block;transition:transform .4s ease;}
.gpi:hover img{transform:scale(1.08);}
.cml{display:flex;flex-direction:column;gap:12px;margin-top:14px;}
.cmi{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:14px;padding:16px 18px;transition:border-color var(--sp);}
.cmi:hover{border-color:rgba(34,211,238,0.1);}
.cmh{display:flex;align-items:center;gap:10px;margin-bottom:9px;}
.cmav{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--cy),var(--pu));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;color:#fff;flex-shrink:0;}
.cmn{font-weight:700;color:var(--tx);font-size:14px;}
.cmd{color:var(--mu);font-size:11.5px;margin-top:1px;}
.cmb{color:var(--mu);font-size:14px;line-height:1.65;}
.cmig{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-top:10px;}
.cmig img{width:100%;height:110px;object-fit:cover;border-radius:9px;border:1px solid var(--border);cursor:zoom-in;transition:transform .25s;}
.cmig img:hover{transform:scale(1.04);}
.empty-c{text-align:center;color:var(--mu);padding:32px;font-size:13.5px;opacity:.7;}
.cfw{margin-top:18px;border-top:1px solid var(--border);padding-top:18px;}
.cfw h4{color:var(--tx);font-size:14.5px;font-weight:700;margin-bottom:14px;}
.cftx{width:100%;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:11px;padding:13px 15px;color:var(--tx);font-size:13.5px;font-family:'DM Sans',sans-serif;outline:none;resize:vertical;min-height:88px;transition:all var(--sp);}
.cftx:focus{border-color:var(--cy);box-shadow:0 0 0 3px rgba(34,211,238,0.08);}
.cfact{display:flex;align-items:center;gap:10px;margin-top:12px;flex-wrap:wrap;}
.cfph{display:inline-flex;align-items:center;gap:6px;cursor:pointer;color:var(--mu);font-size:13px;font-weight:600;padding:9px 14px;background:rgba(255,255,255,0.03);border:1px dashed rgba(255,255,255,0.12);border-radius:10px;transition:all var(--sp);}
.cfph:hover{border-color:var(--cy);color:var(--cy);background:rgba(34,211,238,0.05);}
.cfprev{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;}
.cfpi{position:relative;width:82px;height:82px;border-radius:9px;overflow:hidden;border:1px solid var(--border);}
.cfpi img{width:100%;height:100%;object-fit:cover;display:block;}
.cfpi button{position:absolute;top:4px;right:4px;background:rgba(239,68,68,0.9);color:#fff;border:none;border-radius:6px;width:20px;height:20px;cursor:pointer;font-size:11px;}
.btnp{background:linear-gradient(135deg,var(--cy),var(--pu));color:#fff;border:none;border-radius:10px;padding:10px 22px;font-size:13.5px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all var(--sp);}
.btnp:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(34,211,238,0.25);}
.btnp:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.ln{background:rgba(34,211,238,0.06);border:1px solid rgba(34,211,238,0.16);border-radius:11px;padding:16px 18px;text-align:center;color:var(--mu);font-size:13.5px;}
.ln a{color:var(--cy);font-weight:700;cursor:pointer;text-decoration:underline;}
.ov{position:fixed;inset:0;background:rgba(3,7,18,0.88);backdrop-filter:blur(16px);z-index:9000;display:none;align-items:center;justify-content:center;padding:16px;}
.ov.open{display:flex;}
.mb{background:linear-gradient(160deg,rgba(12,20,69,0.97),rgba(3,7,18,0.99));border:1px solid rgba(34,211,238,0.2);border-radius:22px;padding:34px;width:100%;max-width:440px;box-shadow:0 40px 100px rgba(0,0,0,0.7);position:relative;max-height:90vh;overflow-y:auto;animation:scaleIn .2s ease both;}
.mc{position:absolute;top:14px;right:14px;background:rgba(255,255,255,0.05);border:none;color:var(--mu);width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;transition:all var(--sp);}
.mc:hover{background:rgba(255,255,255,0.1);color:var(--tx);}
.mb h3{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--cy);margin-bottom:5px;}
.mb>p{color:var(--mu);font-size:13px;margin-bottom:22px;}
.mtabs{display:flex;gap:6px;margin-bottom:22px;}
.mtab{flex:1;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--mu);padding:9px;border-radius:9px;cursor:pointer;font-weight:600;font-size:12.5px;font-family:'DM Sans',sans-serif;transition:all var(--sp);}
.mtab.on{background:linear-gradient(135deg,rgba(34,211,238,0.18),rgba(129,140,248,0.18));border-color:rgba(34,211,238,0.3);color:var(--cy);}
.mf{display:none;}
.mf.on{display:block;}
.fg{margin-bottom:16px;}
.fg label{display:block;color:var(--mu);font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;margin-bottom:8px;}
.fg input{width:100%;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09);border-radius:10px;padding:12px 14px;color:var(--tx);font-size:14px;font-family:'DM Sans',sans-serif;outline:none;transition:all var(--sp);}
.fg input:focus{border-color:var(--cy);background:rgba(34,211,238,0.04);}
.mbtn{width:100%;background:linear-gradient(135deg,var(--cy),var(--pu));color:#fff;border:none;border-radius:10px;padding:13px;font-size:14px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all var(--sp);margin-top:6px;}
.mbtn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(34,211,238,0.25);}
.em{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.28);color:#fca5a5;border-radius:9px;padding:10px 13px;font-size:13px;margin-bottom:14px;display:none;}
.em.on{display:block;}
.sm{background:rgba(34,197,94,0.09);border:1px solid rgba(34,197,94,0.22);color:#86efac;border-radius:9px;padding:10px 13px;font-size:13px;margin-bottom:14px;display:none;}
.sm.on{display:block;}
.adp{position:fixed;inset:0;background:linear-gradient(160deg,#030712,#071330);z-index:8000;display:none;overflow-y:auto;}
.adp.open{display:block;}
.adh{background:rgba(3,7,18,0.94);backdrop-filter:blur(16px);border-bottom:1px solid rgba(34,211,238,0.12);padding:14px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
.adb2{display:flex;align-items:center;gap:8px;font-weight:700;color:var(--cy);font-size:15px;}
.adbg{background:linear-gradient(135deg,rgba(34,211,238,0.18),rgba(129,140,248,0.18));border:1px solid rgba(34,211,238,0.28);color:var(--cy);padding:3px 9px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:.06em;}
.adlo{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.22);color:#fca5a5;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;font-size:12.5px;font-family:'DM Sans',sans-serif;transition:all var(--sp);}
.adlo:hover{background:rgba(239,68,68,0.18);}
.adbody{max-width:1040px;margin:0 auto;padding:30px 20px;}
.adt{font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:var(--tx);margin-bottom:4px;}
.ads{color:var(--mu);font-size:13.5px;margin-bottom:28px;}
.tabs{display:flex;gap:7px;margin-bottom:26px;flex-wrap:wrap;}
.tab{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);color:var(--mu);padding:9px 16px;border-radius:10px;cursor:pointer;font-weight:600;font-size:12.5px;font-family:'DM Sans',sans-serif;transition:all var(--sp);}
.tab.on{background:linear-gradient(135deg,rgba(34,211,238,0.16),rgba(129,140,248,0.16));border-color:rgba(34,211,238,0.32);color:var(--cy);}
.tab:hover:not(.on){background:rgba(255,255,255,0.06);color:var(--tx);}
.tp{display:none;}
.tp.on{display:block;}
.ac{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:14px;padding:22px;margin-bottom:18px;}
.ac h3{color:var(--tx);font-size:15px;font-weight:700;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.fl{margin-bottom:16px;}
.fl label{display:block;color:var(--mu);font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px;}
.fl input,.fl textarea,.fl select{width:100%;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09);border-radius:10px;padding:11px 13px;color:var(--tx);font-size:13.5px;font-family:'DM Sans',sans-serif;outline:none;resize:vertical;transition:all var(--sp);}
.fl input:focus,.fl textarea:focus,.fl select:focus{border-color:var(--cy);}
.fl textarea{min-height:82px;}
.fl select option{background:#07101f;}
.sbtn{background:linear-gradient(135deg,var(--cy),var(--pu));color:#fff;border:none;border-radius:10px;padding:10px 22px;font-size:13.5px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all var(--sp);}
.sbtn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(34,211,238,0.2);}
.ok{display:inline-block;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);color:#86efac;padding:7px 13px;border-radius:8px;font-size:12px;font-weight:600;margin-left:10px;opacity:0;transition:opacity .3s;}
.ok.on{opacity:1;}
.upa{border:2px dashed rgba(34,211,238,0.2);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:all var(--sp);background:rgba(34,211,238,0.018);}
.upa:hover{border-color:var(--cy);background:rgba(34,211,238,0.04);}
.upa input{display:none;}
.upi{font-size:28px;margin-bottom:6px;}
.upt{color:var(--mu);font-size:12.5px;}
.upt strong{color:var(--cy);}
.pg{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:14px;}
.pi{position:relative;border-radius:10px;overflow:hidden;background:rgba(255,255,255,0.03);border:1px solid var(--border);}
.pi img{width:100%;height:100px;object-fit:cover;display:block;}
.pi .rm{position:absolute;top:4px;right:4px;background:rgba(239,68,68,0.88);color:#fff;border:none;border-radius:5px;width:22px;height:22px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;}
.pi .pl{padding:5px 7px;font-size:10.5px;color:var(--mu);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}
.agg{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:12px;}
.agi{border-radius:11px;overflow:hidden;background:rgba(255,255,255,0.025);border:1px solid var(--border);transition:border-color var(--sp);}
.agi:hover{border-color:rgba(34,211,238,0.15);}
.agi img{width:100%;height:130px;object-fit:cover;display:block;}
.agif{padding:8px 10px;display:flex;align-items:center;justify-content:space-between;gap:6px;}
.agn{font-size:11px;color:var(--mu);flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}
.db{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);color:#fca5a5;padding:3px 9px;border-radius:6px;cursor:pointer;font-size:11px;font-weight:600;transition:all var(--sp);}
.db:hover{background:rgba(239,68,68,0.22);}
.acmi{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;}
.acmh{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:8px;}
.acmav{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--cy),var(--pu));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;color:#fff;flex-shrink:0;}
.acmn{color:var(--tx);font-size:13.5px;font-weight:700;}
.acmm{color:var(--mu);font-size:11px;margin-top:2px;}
.acmb{color:var(--mu);font-size:13.5px;line-height:1.55;}
.acmig{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
.acmig img{height:90px;width:auto;max-width:140px;object-fit:cover;border-radius:8px;border:1px solid var(--border);cursor:zoom-in;}
.sir{display:flex;align-items:center;gap:10px;padding:10px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid var(--border);margin-bottom:8px;}
.sir img{width:60px;height:45px;object-fit:cover;border-radius:7px;}
.sii{flex:1;font-size:12px;color:var(--mu);}
.sii strong{color:var(--tx);display:block;margin-bottom:2px;font-size:12.5px;}
.cr{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid var(--border);margin-bottom:8px;}
.cr label{flex:1;color:var(--mu);font-size:12.5px;font-weight:600;}
.cr input[type=color]{width:38px;height:32px;border-radius:7px;border:1px solid rgba(255,255,255,0.1);cursor:pointer;background:transparent;padding:2px;}
.cd{width:20px;height:20px;border-radius:50%;border:2px solid rgba(255,255,255,0.1);flex-shrink:0;}
.dcard h3{color:#fca5a5!important;}
.dcard{border-color:rgba(239,68,68,0.18)!important;}
.admerr{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.25);color:#fca5a5;border-radius:8px;padding:9px 12px;font-size:12.5px;margin-top:10px;display:none;}
.admerr.on{display:block;}
.est{text-align:center;color:var(--mu);padding:32px;font-size:13.5px;opacity:.7;}
.tc{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.ut{width:100%;border-collapse:collapse;font-size:12.5px;}
.ut th{text-align:left;padding:8px 10px;color:var(--mu);font-weight:700;text-transform:uppercase;font-size:10px;letter-spacing:.08em;border-bottom:1px solid var(--border);}
.ut td{padding:9px 10px;border-bottom:1px solid rgba(255,255,255,0.03);}
#lbx{position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:99999;display:none;align-items:center;justify-content:center;cursor:zoom-out;padding:16px;}
#lbx img{max-width:100%;max-height:92vh;border-radius:12px;}
.ct .card:nth-child(1){animation-delay:.05s}
.ct .card:nth-child(2){animation-delay:.1s}
.ct .card:nth-child(3){animation-delay:.15s}
.ct .card:nth-child(4){animation-delay:.2s}
.ct .card:nth-child(5){animation-delay:.25s}
.ct .card:nth-child(6){animation-delay:.3s}
.ct .card:nth-child(7){animation-delay:.35s}
@media(max-width:900px){.nl{display:none;}.hbg{display:flex;}h1{font-size:30px;}.hlogo{width:130px;height:130px;}.hc{padding:30px 20px;}}
@media(max-width:600px){.tc{grid-template-columns:1fr;}.adbody{padding:20px 12px;}.card{padding:20px 18px;}}
/* t√≥picos admin */
.topi{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:12px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:flex-start;gap:12px;}
.topi-icon{font-size:22px;flex-shrink:0;margin-top:2px;}
.topi-info{flex:1;min-width:0;}
.topi-title{color:var(--tx);font-weight:700;font-size:14px;margin-bottom:3px;}
.topi-body{color:var(--mu);font-size:12.5px;line-height:1.5;white-space:pre-wrap;word-break:break-word;}
.topi-img{width:60px;height:45px;object-fit:cover;border-radius:7px;border:1px solid var(--border);flex-shrink:0;}
.topi-actions{display:flex;flex-direction:column;gap:5px;flex-shrink:0;}
.topi-up,.topi-dn{background:rgba(255,255,255,0.05);border:1px solid var(--border);color:var(--mu);width:26px;height:26px;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;}
.topi-up:hover,.topi-dn:hover{background:rgba(34,211,238,0.1);color:var(--cy);}
</style>
</head>
<body>
<div class="gl"></div><div class="gr"></div>
<div id="lbx" onclick="this.style.display='none'"><img id="lbxi" src="" alt=""></div>

<nav>
  <div class="ni">
    <a class="nb" href="#">
      <img id="navLogo" src="https://customer-assets.emergentagent.com/job_b08715ae-8740-4bcb-803f-915d1ce2bc24/artifacts/kisdfyxl_BackgroundEraser_20251201_180107491.png" alt="Logo" onerror="this.src='https://via.placeholder.com/40/0ea5e9/fff?text=B'">
      <span>Balc√£o para o Cidad√£o</span>
    </a>
    <ul class="nl" id="navLinks">
      <li><a href="#sobre">Sobre</a></li>
      <li><a href="#missao">Miss√£o</a></li>
      <li><a href="#objetivo">Objetivo</a></li>
      <li><a href="#valores">Valores</a></li>
      <li><a href="#comentarios">Coment√°rios</a></li>
      <li><a href="#contato">Contato</a></li>
      <li id="liLogin"><a href="#" class="nbtn" id="btnOpenLogin">Entrar</a></li>
      <li id="liUser" style="display:none">
        <span class="nusr">
          <span class="navav" id="navAv">?</span>
          <span id="navName" style="color:var(--tx)"></span>
          <a href="#" id="btnLogout" style="color:var(--pk);font-size:11px;margin-left:4px;">Sair</a>
        </span>
      </li>
      <li><a href="#" class="nbtn" id="btnOpenAdmin">‚öô Admin</a></li>
    </ul>
    <button class="hbg" id="btnHamb">‚ò∞</button>
  </div>
</nav>
<div class="mob" id="mobMenu"></div>

<div class="sw">
  <section class="hero">
    <div class="hc">
      <div class="hlogo"><img id="heroLogo" src="https://customer-assets.emergentagent.com/job_b08715ae-8740-4bcb-803f-915d1ce2bc24/artifacts/kisdfyxl_BackgroundEraser_20251201_180107491.png" alt="Logo"></div>
      <div class="hero-text">
        <h1 id="heroTitle">Balc√£o para o Cidad√£o</h1>
        <div class="sub" id="heroSub">Universidade Cat√≥lica do Salvador ‚Äî Projeto de Extens√£o</div>
        <div class="sub" id="heroQuote" style="margin-top:5px">"Voc√™ n√£o √© produto das circunst√¢ncias, mas sim da sua decis√£o" (Viktor Frankl)</div>
      </div>
    </div>
  </section>

  <div class="ct">
    <section id="sobre" class="card">
      <h2>Sobre o Projeto</h2>
      <div class="card-title">O que √©</div>
      <p id="sobreP1">O Balc√£o para o Cidad√£o √© um projeto de extens√£o da UCSal voltado para a√ß√µes sociais e educativas. Conduzido por alunos dos cursos de Direito, Psicologia, Nutri√ß√£o e outros, o projeto atua sob a orienta√ß√£o da professora Denise Gersen Pinto Coelho.</p>
      <p id="sobreP2" style="margin-top:8px">Busca unir teoria e pr√°tica, promovendo oficinas, debates e rodas de conversa para estimular a cidadania e a transforma√ß√£o social.</p>
      <img id="sobreImg" class="simg" src="" alt="" style="display:none">
    </section>
    <section id="missao" class="card">
      <h2>Nossa Miss√£o</h2>
      <div class="card-title">Miss√£o</div>
      <p id="missaoTxt">Estudar, aprender e compartilhar conhecimento com estudantes do ensino fundamental e m√©dio, despertando novas possibilidades e promovendo a transforma√ß√£o pessoal atrav√©s da educa√ß√£o.</p>
      <img id="missaoImg" class="simg" src="" alt="" style="display:none">
    </section>
    <section id="objetivo" class="card">
      <h2>Nosso Objetivo</h2>
      <div class="card-title">Objetivo</div>
      <p id="objetivoTxt">Promover conscientiza√ß√£o pol√≠tica, social e cultural, incentivando jovens a aplicarem a teoria na pr√°tica de forma simples, objetiva e l√∫dica.</p>
      <img id="objetivoImg" class="simg" src="" alt="" style="display:none">
    </section>
    <section id="valores" class="card">
      <h2>Nossos Valores</h2>
      <div class="card-title">Valores</div>
      <div class="vg">
        <div class="val"><strong id="v1t">Motiva√ß√£o e Inspira√ß√£o</strong><p id="v1x">Estimular jovens a explorarem novas possibilidades na vida.</p></div>
        <div class="val"><strong id="v2t">Informa√ß√£o e Conscientiza√ß√£o</strong><p id="v2x">Oferecer conhecimento de forma clara e acess√≠vel.</p></div>
        <div class="val"><strong id="v3t">Di√°logo e Participa√ß√£o</strong><p id="v3x">Incentivar a troca de ideias e experi√™ncias entre estudantes.</p></div>
        <div class="val"><strong id="v4t">Transforma√ß√£o Social</strong><p id="v4x">Promover a√ß√µes que impactem positivamente a comunidade escolar.</p></div>
      </div>
      <img id="valoresImg" class="simg" src="" alt="" style="display:none">
    </section>
    <section id="galeriaSection" class="card" style="display:none">
      <h2 id="galTitle">Galeria de Fotos</h2>
      <div class="gpub" id="pubGal"></div>
    </section>
    <section class="igc card">
      <h2>Siga-nos no Instagram</h2>
      <p style="color:var(--mu)">Acompanhe nossas a√ß√µes e fique por dentro das novidades</p>
      <div class="qrc"><img loading="lazy" src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://instagram.com/balcaoparaocidadao_" alt="QR"></div>
      <a href="https://instagram.com/balcaoparaocidadao_" target="_blank" rel="noopener" class="igbtn">@balcaoparaocidadao_</a>
    </section>
    <section id="contato" class="card">
      <h2>Entre em Contato</h2>
      <p>Para d√∫vidas, parcerias ou informa√ß√µes, envie um e-mail para: <a id="emailContato" href="/cdn-cgi/l/email-protection#d8bab9b4bbb9b798adbbabb9b4f6baaa" style="color:var(--cy);font-weight:700"><span class="__cf_email__" data-cfemail="dcbebdb0bfbdb39ca9bfafbdb0f2beae">[email&#160;protected]</span></a></p>
    </section>
    <div id="topicosContainer"></div>
    <section id="comentarios" class="card">
      <h2>Comunidade</h2>
      <div class="card-title">üí¨ Coment√°rios</div>
      <div class="cml" id="listComents"><div class="empty-c">‚è≥ Carregando...</div></div>
      <div id="formComent"></div>
    </section>
  </div>
  <footer><p id="footerTxt">Projeto de extens√£o ‚Äî Universidade Cat√≥lica do Salvador (UCSal)</p><p style="margin-top:4px">¬© <span id="yr"></span> Todos os direitos reservados</p></footer>
</div>

<!-- MODAL LOGIN -->
<div class="ov" id="modalUser">
  <div class="mb">
    <button class="mc" id="btnCloseUser">‚úï</button>
    <h3>üë§ √Årea do Usu√°rio</h3>
    <p>Fa√ßa login ou cadastre-se para comentar.</p>
    <div class="mtabs">
      <button class="mtab on" id="tabL">Entrar</button>
      <button class="mtab" id="tabR">Cadastrar</button>
    </div>
    <div class="mf on" id="fLogin">
      <div class="em" id="errLogin"></div>
      <div class="fg"><label>E-mail</label><input type="email" id="inLEmail" placeholder="seu@email.com" autocomplete="email"/></div>
      <div class="fg"><label>Senha</label><input type="password" id="inLPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/></div>
      <button class="mbtn" id="btnDoLogin">Entrar</button>
    </div>
    <div class="mf" id="fReg">
      <div class="em" id="errReg"></div>
      <div class="sm" id="sucReg">‚úì Conta criada! Fa√ßa login agora.</div>
      <div class="fg"><label>Nome</label><input type="text" id="inRName" placeholder="Seu nome" autocomplete="name"/></div>
      <div class="fg"><label>E-mail</label><input type="email" id="inREmail" placeholder="seu@email.com" autocomplete="email"/></div>
      <div class="fg"><label>Senha (m√≠n. 6 caracteres)</label><input type="password" id="inRPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password"/></div>
      <button class="mbtn" id="btnDoReg">Criar Conta</button>
    </div>
  </div>
</div>

<!-- MODAL ADMIN -->
<div class="ov" id="modalAdmin">
  <div class="mb">
    <button class="mc" id="btnCloseAdmin">‚úï</button>
    <h3>üîê Acesso Administrativo</h3>
    <p>Credenciais do administrador do site.</p>
    <div class="em" id="errAdmin"></div>
    <div class="fg"><label>Usu√°rio</label><input type="text" id="inAUser" placeholder="admin" autocomplete="username"/></div>
    <div class="fg"><label>Senha</label><input type="password" id="inAPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/></div>
    <button class="mbtn" id="btnDoAdmin">Entrar no Painel</button>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="adp" id="adminPanel">
  <div class="adh">
    <div class="adb2">‚öô Painel Admin <span class="adbg">ADMIN</span></div>
    <button class="adlo" id="btnAdmLogout">Sair do Painel</button>
  </div>
  <div class="adbody">
    <div class="adt">Gerenciar Site</div>
    <div class="ads">Edite textos, imagens e coment√°rios em tempo real.</div>
    <div class="tabs">
      <button class="tab on" data-tp="textos">üìù Textos</button>
      <button class="tab" data-tp="topicos">üìå T√≥picos</button>
      <button class="tab" data-tp="fotos">üñº Fotos</button>
      <button class="tab" data-tp="galeria">üì∏ Galeria</button>
      <button class="tab" data-tp="cores">üé® Cores</button>
      <button class="tab" data-tp="coments">üí¨ Coment√°rios</button>
      <button class="tab" data-tp="users">üë• Usu√°rios</button>
      <button class="tab" data-tp="seg">üîí Seguran√ßa</button>
    </div>
    <div class="tp on" id="tp-textos">
      <div class="ac"><h3>üè† Hero</h3>
        <div class="fl"><label>T√≠tulo</label><input type="text" id="e_heroTitle"/></div>
        <div class="fl"><label>Subt√≠tulo</label><input type="text" id="e_heroSub"/></div>
        <div class="fl"><label>Cita√ß√£o</label><input type="text" id="e_heroQuote"/></div>
        <button class="sbtn" onclick="saveTx('hero')">Salvar</button><span class="ok" id="ok_hero">‚úì Salvo!</span>
      </div>
      <div class="ac"><h3>üìã Sobre / Miss√£o / Objetivo</h3>
        <div class="fl"><label>Sobre ‚Äî Par√°grafo 1</label><textarea id="e_sobreP1"></textarea></div>
        <div class="fl"><label>Sobre ‚Äî Par√°grafo 2</label><textarea id="e_sobreP2"></textarea></div>
        <div class="fl"><label>Miss√£o</label><textarea id="e_missaoTxt"></textarea></div>
        <div class="fl"><label>Objetivo</label><textarea id="e_objetivoTxt"></textarea></div>
        <button class="sbtn" onclick="saveTx('sobre')">Salvar</button><span class="ok" id="ok_sobre">‚úì Salvo!</span>
      </div>
      <div class="ac"><h3>üíé Valores</h3>
        <div class="tc">
          <div class="fl"><label>Valor 1 T√≠tulo</label><input type="text" id="e_v1t"/></div>
          <div class="fl"><label>Valor 1 Texto</label><input type="text" id="e_v1x"/></div>
          <div class="fl"><label>Valor 2 T√≠tulo</label><input type="text" id="e_v2t"/></div>
          <div class="fl"><label>Valor 2 Texto</label><input type="text" id="e_v2x"/></div>
          <div class="fl"><label>Valor 3 T√≠tulo</label><input type="text" id="e_v3t"/></div>
          <div class="fl"><label>Valor 3 Texto</label><input type="text" id="e_v3x"/></div>
          <div class="fl"><label>Valor 4 T√≠tulo</label><input type="text" id="e_v4t"/></div>
          <div class="fl"><label>Valor 4 Texto</label><input type="text" id="e_v4x"/></div>
        </div>
        <button class="sbtn" onclick="saveTx('valores')">Salvar</button><span class="ok" id="ok_valores">‚úì Salvo!</span>
      </div>
      <div class="ac"><h3>üìß Contato</h3>
        <div class="fl"><label>E-mail</label><input type="email" id="e_email"/></div>
        <div class="fl"><label>Texto rodap√©</label><input type="text" id="e_footerTxt"/></div>
        <button class="sbtn" onclick="saveTx('contato')">Salvar</button><span class="ok" id="ok_contato">‚úì Salvo!</span>
      </div>
    </div>
    <div class="tp" id="tp-topicos">
      <div class="ac">
        <h3>‚ûï Novo T√≥pico</h3>
        <div class="fl"><label>T√≠tulo do t√≥pico</label><input type="text" id="nt_title" placeholder="Ex: Parceiros, Depoimentos..."/></div>
        <div class="fl"><label>√çcone (emoji)</label><input type="text" id="nt_icon" placeholder="Ex: ü§ù" maxlength="4" style="width:80px"/></div>
        <div class="fl"><label>Conte√∫do</label><textarea id="nt_body" placeholder="Texto do t√≥pico..." style="min-height:100px"></textarea></div>
        <div class="fl"><label>Foto (opcional)</label>
          <div class="upa" onclick="document.getElementById('nt_img_input').click()" style="padding:14px">
            <input type="file" id="nt_img_input" accept="image/*">
            <div class="upt"><strong>Clique</strong> para adicionar imagem</div>
          </div>
          <div id="nt_img_prev" style="display:none;margin-top:10px;text-align:center">
            <img id="nt_img_preview" src="" style="max-height:100px;border-radius:8px;border:1px solid rgba(255,255,255,0.1)">
            <button onclick="clearNtImg()" style="display:block;margin:6px auto 0;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);color:#fca5a5;padding:4px 12px;border-radius:6px;cursor:pointer;font-size:12px">Remover foto</button>
          </div>
        </div>
        <button class="sbtn" id="btnAddTopico">+ Adicionar T√≥pico</button>
        <span class="ok" id="ok_topico">‚úì Salvo!</span>
      </div>
      <div class="ac">
        <h3>üìã T√≥picos Atuais</h3>
        <div id="admTopicos"><div class="est">Nenhum t√≥pico ainda.</div></div>
      </div>
    </div>
    <div class="tp" id="tp-fotos">
      <div class="ac"><h3>üñº Logo do Site</h3>
        <div class="upa" onclick="document.getElementById('inLogo').click()">
          <input type="file" id="inLogo" accept="image/*">
          <div class="upi">üìÅ</div><div class="upt"><strong>Clique</strong> para selecionar o logo</div>
        </div>
        <div id="logoPrevWrap" style="display:none;margin-top:14px;text-align:center">
          <img id="logoPrev" src="" style="max-height:100px;border-radius:10px;border:1px solid rgba(255,255,255,0.08)">
          <div style="margin-top:10px"><button class="sbtn" id="btnApplyLogo">‚úì Aplicar Logo</button><span class="ok" id="ok_logo">‚úì Logo atualizado!</span></div>
        </div>
      </div>
      <div class="ac"><h3>üìå Foto por Se√ß√£o</h3>
        <div class="fl"><label>Se√ß√£o</label>
          <select id="selSec"><option value="sobre">Sobre</option><option value="missao">Miss√£o</option><option value="objetivo">Objetivo</option><option value="valores">Valores</option></select>
        </div>
        <div class="upa" onclick="document.getElementById('inSecImg').click()">
          <input type="file" id="inSecImg" accept="image/*">
          <div class="upi">üñº</div><div class="upt"><strong>Clique</strong> para selecionar imagem</div>
        </div>
        <div id="secImgPrevWrap" style="display:none;margin-top:14px;text-align:center">
          <img id="secImgPrev" src="" style="max-height:120px;border-radius:10px;border:1px solid rgba(255,255,255,0.08)">
          <div style="margin-top:10px"><button class="sbtn" id="btnApplySecImg">‚úì Aplicar Imagem</button><span class="ok" id="ok_secimg">‚úì Aplicado!</span></div>
        </div>
        <div id="curSecImgs" style="margin-top:16px"></div>
      </div>
    </div>
    <div class="tp" id="tp-galeria">
      <div class="ac"><h3>üì∏ Adicionar Imagens</h3>
        <div class="fl"><label>T√≠tulo da galeria</label><input type="text" id="e_galTitle" value="Galeria de Fotos"/></div>
        <div class="upa" id="galDrop" onclick="document.getElementById('inGal').click()">
          <input type="file" id="inGal" accept="image/*" multiple>
          <div class="upi">üñº</div><div class="upt"><strong>Clique ou arraste</strong> m√∫ltiplas imagens</div>
        </div>
        <div class="pg" id="galPend"></div>
        <div id="galBtnWrap" style="display:none;margin-top:14px">
          <button class="sbtn" id="btnConfirmGal">‚úì Adicionar √† Galeria</button><span class="ok" id="ok_gal">‚úì Adicionado!</span>
        </div>
      </div>
      <div class="ac"><h3>üóÇ Imagens na Galeria</h3><div class="agg" id="admGal"></div></div>
    </div>
    <div class="tp" id="tp-cores">
      <div class="ac"><h3>üé® Cores do Site</h3>
        <div class="cr"><label>Cor Principal (Cyan)</label><input type="color" id="cp_cy" value="#06b6d4"><div class="cd" id="cd_cy"></div></div>
        <div class="cr"><label>Cor Secund√°ria (Roxo)</label><input type="color" id="cp_pu" value="#7c3aed"><div class="cd" id="cd_pu"></div></div>
        <div class="cr"><label>Cor de Destaque (Rosa)</label><input type="color" id="cp_pk" value="#ec4899"><div class="cd" id="cd_pk"></div></div>
        <div class="cr"><label>Fundo Escuro</label><input type="color" id="cp_bg1" value="#020617"><div class="cd" id="cd_bg1"></div></div>
        <div class="cr"><label>Fundo Azul</label><input type="color" id="cp_bg2" value="#0b2a5f"><div class="cd" id="cd_bg2"></div></div>
        <div class="cr"><label>Texto</label><input type="color" id="cp_tx" value="#e8faff"><div class="cd" id="cd_tx"></div></div>
        <div class="cr"><label>Texto Suave</label><input type="color" id="cp_mu" value="#9cc7d6"><div class="cd" id="cd_mu"></div></div>
        <button class="sbtn" id="btnSaveCores">Salvar Cores</button>
        <button class="sbtn" id="btnResetCores" style="margin-left:8px;background:rgba(255,255,255,0.08);color:var(--mu)">Resetar</button>
        <span class="ok" id="ok_cores">‚úì Salvo!</span>
      </div>
    </div>
    <div class="tp" id="tp-coments">
      <div class="ac"><h3>üí¨ Gerenciar Coment√°rios</h3><div id="admComents"></div></div>
    </div>
    <div class="tp" id="tp-users">
      <div class="ac"><h3>üë• Usu√°rios Cadastrados</h3><div id="admUsers"></div></div>
    </div>
    <div class="tp" id="tp-seg">
      <div class="ac dcard"><h3>üîë Alterar Senha Admin</h3>
        <div class="fl"><label>Senha Atual</label><input type="password" id="e_oldP" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <div class="fl"><label>Nova Senha</label><input type="password" id="e_newP" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <div class="fl"><label>Confirmar Nova Senha</label><input type="password" id="e_cfP" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <button class="sbtn" id="btnChPass">Alterar Senha</button><span class="ok" id="ok_pass">‚úì Alterado!</span>
        <div class="admerr" id="errPass"></div>
      </div>
      <div class="ac"><h3>üë§ Alterar Usu√°rio Admin</h3>
        <div class="fl"><label>Novo Usu√°rio</label><input type="text" id="e_newU" placeholder="admin"/></div>
        <div class="fl"><label>Confirmar Senha</label><input type="password" id="e_cfPU" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
        <button class="sbtn" id="btnChUser">Alterar Usu√°rio</button><span class="ok" id="ok_user">‚úì Alterado!</span>
        <div class="admerr" id="errUser"></div>
      </div>
    </div>
  </div>
</div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { getFirestore, doc, getDoc, setDoc, collection, addDoc, getDocs, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyBdxd54oFM3eWH1duC5BTdJzjGGRDLMq-Q",
  authDomain: "mary-cb817.firebaseapp.com",
  projectId: "mary-cb817",
  storageBucket: "mary-cb817.firebasestorage.app",
  messagingSenderId: "887348832569",
  appId: "1:887348832569:web:c6d9c32a1a1c402b8960e8"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

// ‚îÄ‚îÄ UTILIT√ÅRIOS ‚îÄ‚îÄ
const G   = id => document.getElementById(id);
const esc = s  => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const flash = id => { const e=G(id); if(!e)return; e.classList.add('on'); setTimeout(()=>e.classList.remove('on'),2600); };

// ‚îÄ‚îÄ FIRESTORE ‚îÄ‚îÄ
async function fbGet(path){
  try {
    const snap = await getDoc(doc(db,...path.split('/')));
    return snap.exists() ? snap.data() : null;
  } catch(e){ console.error('fbGet',e); return null; }
}
async function fbSave(path, data, merge=true){
  await setDoc(doc(db,...path.split('/')), data, {merge});
}

// ‚îÄ‚îÄ SESS√ÉO LOCAL ‚îÄ‚îÄ
const getSess  = () => { try{ const v=localStorage.getItem('bpc_sess'); return v?JSON.parse(v):null; }catch(e){return null;} };
const setSess  = v  => { try{ localStorage.setItem('bpc_sess',JSON.stringify(v)); }catch(e){} };
const clearSess= () => { try{ localStorage.removeItem('bpc_sess'); }catch(e){} };

// ‚îÄ‚îÄ COMPRESSOR ‚îÄ‚îÄ
function compressImg(file, maxPx, cb){
  const r=new FileReader();
  r.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      let w=img.width,h=img.height;
      if(w>maxPx||h>maxPx){ if(w>h){h=Math.round(h*maxPx/w);w=maxPx;}else{w=Math.round(w*maxPx/h);h=maxPx;} }
      const c=document.createElement('canvas'); c.width=w; c.height=h;
      c.getContext('2d').drawImage(img,0,0,w,h);
      cb(c.toDataURL('image/jpeg',0.72));
    };
    img.src=e.target.result;
  };
  r.readAsDataURL(file);
}

G('yr').textContent = new Date().getFullYear();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTE√öDO / CORES / IMAGENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _cnt={}, _colors={}, _secImgs={};

async function loadSiteData(){
  const [ct,cl,si,gd] = await Promise.all([
    fbGet('site/content'), fbGet('site/colors'),
    fbGet('site/secImgs'), fbGet('site/content')
  ]);
  _cnt     = ct || {};
  _colors  = cl || {};
  _secImgs = si || {};
  applyContent();
  applyColors();
  renderGalPub(_cnt.galeria||[]);
}

function applyContent(){
  const c=_cnt;
  ['heroTitle','heroSub','heroQuote','sobreP1','sobreP2','missaoTxt','objetivoTxt',
   'v1t','v1x','v2t','v2x','v3t','v3x','v4t','v4x','galTitle','footerTxt'].forEach(k=>{
    if(c[k]!=null){ const e=G(k); if(e)e.textContent=c[k]; }
  });
  if(c.email){ const a=G('emailContato'); if(a){a.textContent=c.email;a.href='mailto:'+c.email;} }
  if(c.logo){ G('navLogo').src=c.logo; G('heroLogo').src=c.logo; }
  ['sobre','missao','objetivo','valores'].forEach(s=>{
    const img=G(s+'Img');
    if(img){ if(_secImgs[s]){img.src=_secImgs[s];img.style.display='';}else img.style.display='none'; }
  });
}

const DC={'--cy':'#06b6d4','--pu':'#7c3aed','--pk':'#ec4899','--bg1':'#020617','--bg2':'#0b2a5f','--tx':'#e8faff','--mu':'#9cc7d6'};
const CI={'--cy':'cp_cy','--pu':'cp_pu','--pk':'cp_pk','--bg1':'cp_bg1','--bg2':'cp_bg2','--tx':'cp_tx','--mu':'cp_mu'};
const CDI={'--cy':'cd_cy','--pu':'cd_pu','--pk':'cd_pk','--bg1':'cd_bg1','--bg2':'cd_bg2','--tx':'cd_tx','--mu':'cd_mu'};

function applyColors(){
  const c=Object.keys(_colors).length?_colors:DC;
  Object.keys(DC).forEach(k=>document.documentElement.style.setProperty(k,c[k]||DC[k]));
}
function loadColorsPanel(){
  const c=Object.keys(_colors).length?_colors:DC;
  Object.keys(CI).forEach(v=>{ const i=G(CI[v]),d=G(CDI[v]),val=c[v]||DC[v]; if(i)i.value=val; if(d)d.style.background=val; });
}

window.saveTx = async function(sec){
  const m={hero:['heroTitle','heroSub','heroQuote'],sobre:['sobreP1','sobreP2','missaoTxt','objetivoTxt'],
    valores:['v1t','v1x','v2t','v2x','v3t','v3x','v4t','v4x'],contato:['footerTxt']};
  (m[sec]||[]).forEach(id=>{ const e=G('e_'+id); if(e)_cnt[id]=e.value; });
  if(sec==='contato'){ const ea=G('e_email'); if(ea)_cnt.email=ea.value.trim(); const ef=G('e_footerTxt'); if(ef)_cnt.footerTxt=ef.value; }
  await fbSave('site/content',_cnt);
  applyContent(); flash('ok_'+sec);
};

// logo
let _pLogo=null;
G('inLogo').addEventListener('change',function(){
  const f=this.files[0]; if(!f)return;
  compressImg(f,400,d=>{ _pLogo=d; G('logoPrev').src=d; G('logoPrevWrap').style.display=''; });
});
G('btnApplyLogo').addEventListener('click',async()=>{
  if(!_pLogo)return;
  _cnt.logo=_pLogo;
  await fbSave('site/content',{logo:_pLogo});
  G('navLogo').src=_pLogo; G('heroLogo').src=_pLogo; flash('ok_logo');
});

// fotos por se√ß√£o
let _pSec=null;
G('inSecImg').addEventListener('change',function(){
  const f=this.files[0]; if(!f)return;
  compressImg(f,1200,d=>{ _pSec=d; G('secImgPrev').src=d; G('secImgPrevWrap').style.display=''; });
});
G('btnApplySecImg').addEventListener('click',async()=>{
  if(!_pSec)return;
  const s=G('selSec').value; _secImgs[s]=_pSec;
  await fbSave('site/secImgs',_secImgs);
  const img=G(s+'Img'); if(img){img.src=_pSec;img.style.display='';}
  _pSec=null; G('secImgPrevWrap').style.display='none';
  renderCurSec(); flash('ok_secimg');
});
window.rmSecImg=async s=>{
  delete _secImgs[s]; await fbSave('site/secImgs',_secImgs);
  const img=G(s+'Img'); if(img)img.style.display='none'; renderCurSec();
};
function renderCurSec(){
  const w=G('curSecImgs'); if(!w)return;
  const lb2={sobre:'Sobre',missao:'Miss√£o',objetivo:'Objetivo',valores:'Valores'};
  const keys=Object.keys(_secImgs);
  if(!keys.length){w.innerHTML='<div class="est" style="padding:14px">Nenhuma imagem de se√ß√£o.</div>';return;}
  w.innerHTML=keys.map(k=>`<div class="sir"><img src="${_secImgs[k]}"><div class="sii"><strong>${lb2[k]||k}</strong>Imagem aplicada</div><button class="db" onclick="rmSecImg('${k}')">Remover</button></div>`).join('');
}

// cores
Object.keys(CI).forEach(v=>{
  setTimeout(()=>{
    const i=G(CI[v]); if(!i)return;
    i.addEventListener('input',function(){ document.documentElement.style.setProperty(v,this.value); const d=G(CDI[v]); if(d)d.style.background=this.value; });
  },400);
});
G('btnSaveCores').addEventListener('click',async()=>{
  const c={}; Object.keys(CI).forEach(v=>{ const i=G(CI[v]); if(i)c[v]=i.value; });
  _colors=c; await fbSave('site/colors',c); applyColors(); flash('ok_cores');
});
G('btnResetCores').addEventListener('click',async()=>{
  _colors=Object.assign({},DC); await fbSave('site/colors',DC); applyColors(); loadColorsPanel(); flash('ok_cores');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMENT√ÅRIOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.lb = src=>{ G('lbxi').src=src; G('lbx').style.display='flex'; };

function renderCometsList(cmts){
  const list=G('listComents'); if(!list)return;
  if(!cmts.length){list.innerHTML='<div class="empty-c">Seja o primeiro a comentar! üí¨</div>';return;}
  list.innerHTML=cmts.map(c=>{
    const imgs=c.imgs&&c.imgs.length?c.imgs:[];
    const ig=imgs.length?'<div class="cmig">'+imgs.map(s=>`<img src="${s}" loading="lazy" onclick="lb(this.src)">`).join('')+'</div>':'';
    return`<div class="cmi"><div class="cmh"><div class="cmav">${esc(c.name.charAt(0).toUpperCase())}</div><div><div class="cmn">${esc(c.name)}</div><div class="cmd">${esc(c.date)}</div></div></div>${c.text?`<div class="cmb">${esc(c.text)}</div>`:''}${ig}</div>`;
  }).join('');
}

// escuta em tempo real
onSnapshot(collection(db,'comentarios'), snap=>{
  const cmts=snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.ts||0)-(a.ts||0));
  renderCometsList(cmts);
  // atualiza painel admin se aberto
  const admW=G('admComents'); if(admW&&G('adminPanel').classList.contains('open')) renderAdmComents(cmts);
}, err=>{
  const list=G('listComents');
  if(list) list.innerHTML=`<div class="empty-c">‚ö†Ô∏è Erro Firebase: ${err.message}</div>`;
});

let _pImgs=[];
function renderCForm(){
  const area=G('formComent'); if(!area)return;
  const sess=getSess(); _pImgs=[];
  if(sess){
    area.innerHTML=`
      <div class="cfw">
        <h4>Comentar como <span style="color:var(--cy)">${esc(sess.name)}</span></h4>
        <textarea class="cftx" id="cfTx" placeholder="Escreva seu coment√°rio..."></textarea>
        <div class="cfact">
          <label class="cfph" for="cfFile">üì∑ Adicionar fotos</label>
          <input type="file" id="cfFile" accept="image/*" multiple style="display:none">
          <button class="btnp" id="cfSend">‚úà Publicar</button>
        </div>
        <div id="cfPrevArea" style="display:none;margin-top:10px"><div class="cfprev" id="cfPrev"></div></div>
      </div>`;
    G('cfFile').addEventListener('change',function(){
      Array.from(this.files).forEach(f=>compressImg(f,800,d=>{ _pImgs.push(d); renderCPrev(); }));
      this.value='';
    });
    G('cfSend').addEventListener('click',async()=>{
      const sess=getSess(); if(!sess)return;
      const txEl=G('cfTx'); const tx=txEl?txEl.value.trim():'';
      if(!tx&&!_pImgs.length){ if(txEl){txEl.style.borderColor='rgba(239,68,68,0.5)';setTimeout(()=>txEl.style.borderColor='',1500);} return; }
      const btn=G('cfSend'); btn.disabled=true; btn.textContent='Enviando...';
      try{
        await addDoc(collection(db,'comentarios'),{
          name:sess.name,email:sess.email,text:tx,
          imgs:[..._pImgs],
          date:new Date().toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}),
          ts:Date.now()
        });
        if(txEl)txEl.value=''; _pImgs=[]; renderCPrev();
      }catch(e){ alert('Erro ao publicar: '+e.message); }
      finally{ btn.disabled=false; btn.textContent='‚úà Publicar'; }
    });
  } else {
    area.innerHTML='<div class="cfw"><div class="ln">Para comentar, <a onclick="openLogin()">fa√ßa login</a> ou <a onclick="openLogin(\'r\')">cadastre-se</a> ‚Äî √© r√°pido e gr√°tis!</div></div>';
  }
}
function renderCPrev(){
  const a=G('cfPrevArea'),p=G('cfPrev'); if(!a||!p)return;
  if(!_pImgs.length){a.style.display='none';p.innerHTML='';return;}
  a.style.display='';
  p.innerHTML=_pImgs.map((s,i)=>`<div class="cfpi"><img src="${s}"><button type="button" onclick="rmPI(${i})">‚úï</button></div>`).join('');
}
window.rmPI=i=>{ _pImgs.splice(i,1); renderCPrev(); };

function renderAdmComents(cmts){
  const w=G('admComents'); if(!w)return;
  if(!cmts||!cmts.length){w.innerHTML='<div class="est">Nenhum coment√°rio ainda.</div>';return;}
  w.innerHTML=cmts.map(c=>{
    const imgs=c.imgs&&c.imgs.length?c.imgs:[];
    const ig=imgs.length?'<div class="acmig">'+imgs.map(s=>`<img src="${s}" onclick="lb(this.src)">`).join('')+'</div>':'';
    return`<div class="acmi"><div class="acmh"><div style="display:flex;align-items:center;gap:10px;flex:1"><div class="acmav">${esc(c.name.charAt(0).toUpperCase())}</div><div><div class="acmn">${esc(c.name)}</div><div class="acmm">${esc(c.email||'')} ¬∑ ${esc(c.date)}${imgs.length?` ¬∑ <span style="color:var(--cy)">${imgs.length} foto(s)</span>`:''}</div></div></div><button class="db" onclick="delCmt('${c.id}')">üóë Apagar</button></div>${c.text?`<div class="acmb">${esc(c.text)}</div>`:''}${ig}</div>`;
  }).join('');
}
window.delCmt=async id=>{ if(!confirm('Apagar?'))return; await deleteDoc(doc(db,'comentarios',id)); };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GALERIA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderGalPub(gal){
  const sec=G('galeriaSection'),grid=G('pubGal');
  if(!gal||!gal.length){if(sec)sec.style.display='none';return;}
  if(sec)sec.style.display='';
  if(grid)grid.innerHTML=gal.map(img=>`<div class="gpi"><img src="${img.src}" alt="${esc(img.name)}" loading="lazy" onclick="lb(this.src)"></div>`).join('');
}
async function renderAdmGal(){
  const d=await fbGet('site/content'); const gal=d?.galeria||[];
  const gr=G('admGal'); if(!gr)return;
  if(!gal.length){gr.innerHTML='<div class="est">Nenhuma imagem ainda.</div>';return;}
  gr.innerHTML=gal.map((img,i)=>`<div class="agi"><img src="${img.src}" alt="${esc(img.name)}" loading="lazy" onclick="lb(this.src)"><div class="agif"><span class="agn">${esc(img.name)}</span><button class="db" onclick="delGI(${i})">Remover</button></div></div>`).join('');
}
let _pGal=[];
G('inGal').addEventListener('change',function(){
  Array.from(this.files).forEach(f=>compressImg(f,1000,d=>{ _pGal.push({src:d,name:f.name}); renderGalPend(); }));
  this.value='';
});
const gd=G('galDrop');
gd.addEventListener('dragover',e=>{e.preventDefault();gd.style.borderColor='var(--cy)';});
gd.addEventListener('dragleave',()=>gd.style.borderColor='');
gd.addEventListener('drop',e=>{ e.preventDefault();gd.style.borderColor='';
  Array.from(e.dataTransfer.files).filter(f=>f.type.startsWith('image/')).forEach(f=>compressImg(f,1000,d=>{ _pGal.push({src:d,name:f.name}); renderGalPend(); }));
});
function renderGalPend(){
  const p=G('galPend'),b=G('galBtnWrap');
  if(!_pGal.length){p.innerHTML='';b.style.display='none';return;}
  b.style.display='';
  p.innerHTML=_pGal.map((img,i)=>`<div class="pi"><img src="${img.src}"><button class="rm" onclick="rmPG(${i})">‚úï</button><div class="pl">${esc(img.name)}</div></div>`).join('');
}
window.rmPG=i=>{ _pGal.splice(i,1); renderGalPend(); };
G('btnConfirmGal').addEventListener('click',async()=>{
  const d=await fbGet('site/content'); const gal=[...(d?.galeria||[]),..._pGal];
  const gt=G('e_galTitle'); if(gt)_cnt.galTitle=gt.value;
  await fbSave('site/content',{galeria:gal,galTitle:_cnt.galTitle||'Galeria de Fotos'});
  _pGal=[]; renderGalPend(); renderAdmGal(); renderGalPub(gal); flash('ok_gal');
});
window.delGI=async function(i){
  const d=await fbGet('site/content'); const gal=d?.galeria||[]; gal.splice(i,1);
  await fbSave('site/content',{galeria:gal},false);
  renderAdmGal(); renderGalPub(gal);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// USU√ÅRIOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function getUsers(){ const d=await fbGet('site/users'); return d?.list||[]; }
async function saveUsers(list){ await fbSave('site/users',{list},false); }

async function renderAdmUsers(){
  const us=await getUsers(); const w=G('admUsers'); if(!w)return;
  if(!us.length){w.innerHTML='<div class="est">Nenhum usu√°rio cadastrado ainda.</div>';return;}
  w.innerHTML='<table class="ut"><tr><th>Nome</th><th>E-mail</th><th>Cadastro</th><th></th></tr>'+
    us.map((u,i)=>`<tr><td style="color:var(--tx)">${esc(u.name)}</td><td style="color:var(--mu)">${esc(u.email)}</td><td style="color:var(--mu)">${u.createdAt||'‚Äî'}</td><td><button class="db" onclick="delUser(${i})">Remover</button></td></tr>`).join('')+'</table>';
}
window.delUser=async function(i){
  if(!confirm('Remover?'))return;
  const us=await getUsers(); const s=getSess();
  if(s&&s.email===us[i].email){clearSess();updateNavUser();renderCForm();}
  us.splice(i,1); await saveUsers(us); renderAdmUsers();
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH USU√ÅRIO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateNavUser(){
  const s=getSess(); const liL=G('liLogin'),liU=G('liUser');
  if(s){ if(liL)liL.style.display='none'; if(liU)liU.style.display='';
    const av=G('navAv'),nm=G('navName');
    if(av)av.textContent=s.name.charAt(0).toUpperCase();
    if(nm)nm.textContent=s.name.split(' ')[0];
  } else { if(liL)liL.style.display=''; if(liU)liU.style.display='none'; }
}
G('btnLogout').addEventListener('click',e=>{e.preventDefault();clearSess();updateNavUser();renderCForm();});

window.openLogin=function(tab){
  G('modalUser').classList.add('open');
  ['errLogin','errReg','sucReg'].forEach(id=>{const e=G(id);if(e)e.classList.remove('on');});
  if(tab==='r'){G('tabL').classList.remove('on');G('tabR').classList.add('on');G('fLogin').classList.remove('on');G('fReg').classList.add('on');}
  else{G('tabL').classList.add('on');G('tabR').classList.remove('on');G('fLogin').classList.add('on');G('fReg').classList.remove('on');}
  setTimeout(()=>tab==='r'?G('inRName').focus():G('inLEmail').focus(),100);
};
G('btnOpenLogin').addEventListener('click',e=>{e.preventDefault();openLogin();});
G('btnCloseUser').addEventListener('click',()=>G('modalUser').classList.remove('open'));
G('modalUser').addEventListener('click',e=>{if(e.target===G('modalUser'))G('modalUser').classList.remove('open');});
G('tabL').addEventListener('click',function(){this.classList.add('on');G('tabR').classList.remove('on');G('fLogin').classList.add('on');G('fReg').classList.remove('on');});
G('tabR').addEventListener('click',function(){this.classList.add('on');G('tabL').classList.remove('on');G('fReg').classList.add('on');G('fLogin').classList.remove('on');});

G('btnDoLogin').addEventListener('click',doLogin);
[G('inLEmail'),G('inLPass')].forEach(el=>el.addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();}));
async function doLogin(){
  const em=G('inLEmail').value.trim().toLowerCase(), pw=G('inLPass').value;
  const err=G('errLogin'); err.classList.remove('on');
  if(!em||!pw){err.textContent='Preencha todos os campos.';err.classList.add('on');return;}
  const users=await getUsers();
  const user=users.find(u=>u.email.toLowerCase()===em&&u.pass===pw);
  if(!user){err.textContent='E-mail ou senha incorretos.';err.classList.add('on');return;}
  setSess({name:user.name,email:user.email});
  G('modalUser').classList.remove('open');
  G('inLEmail').value=''; G('inLPass').value='';
  updateNavUser(); renderCForm();
}

G('btnDoReg').addEventListener('click',doReg);
G('inRPass').addEventListener('keydown',e=>{if(e.key==='Enter')doReg();});
async function doReg(){
  const name=G('inRName').value.trim(), em=G('inREmail').value.trim().toLowerCase(), pw=G('inRPass').value;
  const err=G('errReg'),suc=G('sucReg'); err.classList.remove('on'); suc.classList.remove('on');
  if(!name||!em||!pw){err.textContent='Preencha todos os campos.';err.classList.add('on');return;}
  if(pw.length<6){err.textContent='Senha deve ter m√≠nimo 6 caracteres.';err.classList.add('on');return;}
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em)){err.textContent='E-mail inv√°lido.';err.classList.add('on');return;}
  const users=await getUsers();
  if(users.find(u=>u.email.toLowerCase()===em)){err.textContent='E-mail j√° cadastrado.';err.classList.add('on');return;}
  users.push({name,email:em,pass:pw,createdAt:new Date().toLocaleDateString('pt-BR')});
  try{ await saveUsers(users); }
  catch(e){err.textContent='Erro ao salvar: '+e.message;err.classList.add('on');return;}
  G('inRName').value=''; G('inREmail').value=''; G('inRPass').value='';
  suc.classList.add('on'); setTimeout(()=>G('tabL').click(),1600);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function getCreds(){ const d=await fbGet('site/admin'); return d||{user:'admin',pass:'projeto1234'}; }

G('btnOpenAdmin').addEventListener('click',e=>{e.preventDefault();G('modalAdmin').classList.add('open');setTimeout(()=>G('inAUser').focus(),100);});
G('btnCloseAdmin').addEventListener('click',()=>G('modalAdmin').classList.remove('open'));
G('modalAdmin').addEventListener('click',e=>{if(e.target===G('modalAdmin'))G('modalAdmin').classList.remove('open');});
G('btnDoAdmin').addEventListener('click',doAdminLogin);
[G('inAUser'),G('inAPass')].forEach(el=>el.addEventListener('keydown',e=>{if(e.key==='Enter')doAdminLogin();}));
async function doAdminLogin(){
  const u=G('inAUser').value.trim(), p=G('inAPass').value;
  const err=G('errAdmin'); err.classList.remove('on');
  const cr=await getCreds();
  if(u===cr.user&&p===cr.pass){
    G('modalAdmin').classList.remove('open'); G('inAUser').value=''; G('inAPass').value='';
    openAdmin();
  } else { err.textContent='Usu√°rio ou senha incorretos.'; err.classList.add('on'); G('inAPass').value=''; }
}
function openAdmin(){
  G('adminPanel').classList.add('open'); document.body.style.overflow='hidden';
  populateFields(); renderAdmGal(); renderAdmUsers(); renderCurSec(); loadColorsPanel();
  getDocs(collection(db,'comentarios')).then(snap=>{
    renderAdmComents(snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.ts||0)-(a.ts||0)));
  });
  renderAdmTopicos();
}
G('btnAdmLogout').addEventListener('click',()=>{G('adminPanel').classList.remove('open');document.body.style.overflow='';});

document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',function(){
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('on'));
    document.querySelectorAll('.tp').forEach(x=>x.classList.remove('on'));
    this.classList.add('on'); G('tp-'+this.dataset.tp).classList.add('on');
    if(this.dataset.tp==='coments') getDocs(collection(db,'comentarios')).then(snap=>renderAdmComents(snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.ts||0)-(a.ts||0))));
    if(this.dataset.tp==='users') renderAdmUsers();
    if(this.dataset.tp==='topicos') renderAdmTopicos();
  });
});

function populateFields(){
  const c=_cnt;
  ['heroTitle','heroSub','heroQuote','sobreP1','sobreP2','missaoTxt','objetivoTxt','v1t','v1x','v2t','v2x','v3t','v3x','v4t','v4x','galTitle','footerTxt'].forEach(id=>{
    const e=G('e_'+id); if(!e)return; e.value=c[id]!=null?c[id]:(G(id)?G(id).textContent:'');
  });
  const ea=G('e_email'); if(ea)ea.value=c.email||'';
  const ef=G('e_footerTxt'); if(ef)ef.value=c.footerTxt||'';
}

G('btnChPass').addEventListener('click',async()=>{
  const op=G('e_oldP').value,np=G('e_newP').value,cf=G('e_cfP').value;
  const err=G('errPass'); err.classList.remove('on');
  const cr=await getCreds();
  if(op!==cr.pass){err.textContent='Senha atual incorreta.';err.classList.add('on');return;}
  if(np.length<6){err.textContent='M√≠nimo 6 caracteres.';err.classList.add('on');return;}
  if(np!==cf){err.textContent='Senhas n√£o coincidem.';err.classList.add('on');return;}
  await fbSave('site/admin',{user:cr.user,pass:np},false);
  G('e_oldP').value=''; G('e_newP').value=''; G('e_cfP').value=''; flash('ok_pass');
});
G('btnChUser').addEventListener('click',async()=>{
  const nu=G('e_newU').value.trim(),pw=G('e_cfPU').value;
  const err=G('errUser'); err.classList.remove('on');
  const cr=await getCreds();
  if(pw!==cr.pass){err.textContent='Senha incorreta.';err.classList.add('on');return;}
  if(!nu){err.textContent='Digite um nome de usu√°rio.';err.classList.add('on');return;}
  await fbSave('site/admin',{user:nu,pass:cr.pass},false);
  G('e_newU').value=''; G('e_cfPU').value=''; flash('ok_user');
});

// ‚îÄ‚îÄ MOBILE NAV ‚îÄ‚îÄ
const hb=G('btnHamb'),mm=G('mobMenu');
hb.addEventListener('click',()=>{
  if(mm.style.display==='flex'){mm.style.display='none';return;}
  mm.innerHTML='';
  G('navLinks').querySelectorAll('a').forEach(a=>{
    const cl=a.cloneNode(true); cl.addEventListener('click',()=>mm.style.display='none'); mm.appendChild(cl);
  });
  mm.style.display='flex';
});
document.addEventListener('click',e=>{if(!mm.contains(e.target)&&e.target!==hb)mm.style.display='none';});

// ‚îÄ‚îÄ SMOOTH SCROLL ‚îÄ‚îÄ
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click',e=>{
    const h=a.getAttribute('href'); if(!h||h==='#')return;
    const t=document.querySelector(h);
    if(t){e.preventDefault();window.scrollTo({top:t.getBoundingClientRect().top+window.pageYOffset-84,behavior:'smooth'});}
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// T√ìPICOS DIN√ÇMICOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function getTopicos(){ const d=await fbGet('site/topicos'); return d?.list||[]; }
async function saveTopicos(list){ await fbSave('site/topicos',{list},false); }

function renderTopicosPublic(topicos){
  const container=G('topicosContainer'); if(!container)return;
  if(!topicos||!topicos.length){container.innerHTML='';return;}
  container.innerHTML=topicos.map(t=>`
    <section class="card" style="animation-delay:.18s">
      <h2>${esc(t.icon||'üìå')} ${esc(t.title)}</h2>
      <div class="card-title">${esc(t.title)}</div>
      ${t.body?`<p style="white-space:pre-wrap">${esc(t.body)}</p>`:''}
      ${t.img?`<img class="simg" src="${t.img}" alt="${esc(t.title)}">`:''}
    </section>`).join('');
}

async function renderAdmTopicos(){
  const topicos=await getTopicos();
  const w=G('admTopicos'); if(!w)return;
  if(!topicos.length){w.innerHTML='<div class="est">Nenhum t√≥pico ainda.</div>';return;}
  w.innerHTML=topicos.map((t,i)=>`
    <div class="topi">
      <div class="topi-icon">${esc(t.icon||'üìå')}</div>
      <div class="topi-info">
        <div class="topi-title">${esc(t.title)}</div>
        ${t.body?`<div class="topi-body">${esc(t.body)}</div>`:''}
      </div>
      ${t.img?`<img class="topi-img" src="${t.img}">`:''}
      <div class="topi-actions">
        <button class="topi-up" onclick="moveTopico(${i},-1)" title="Subir">‚Üë</button>
        <button class="topi-dn" onclick="moveTopico(${i},1)" title="Descer">‚Üì</button>
        <button class="db" onclick="delTopico(${i})">üóë</button>
      </div>
    </div>`).join('');
}

let _ntImg=null;
G('nt_img_input').addEventListener('change',function(){
  const f=this.files[0]; if(!f)return;
  compressImg(f,1200,d=>{ _ntImg=d; G('nt_img_preview').src=d; G('nt_img_prev').style.display=''; });
  this.value='';
});
window.clearNtImg=()=>{ _ntImg=null; G('nt_img_prev').style.display='none'; G('nt_img_preview').src=''; };

G('btnAddTopico').addEventListener('click',async()=>{
  const title=G('nt_title').value.trim();
  const icon=G('nt_icon').value.trim()||'üìå';
  const body=G('nt_body').value.trim();
  if(!title){G('nt_title').style.borderColor='rgba(239,68,68,0.5)';setTimeout(()=>G('nt_title').style.borderColor='',1500);return;}
  const topicos=await getTopicos();
  topicos.push({title,icon,body,img:_ntImg||null});
  await saveTopicos(topicos);
  G('nt_title').value=''; G('nt_icon').value=''; G('nt_body').value=''; clearNtImg();
  renderAdmTopicos(); renderTopicosPublic(topicos); flash('ok_topico');
});

window.delTopico=async function(i){
  if(!confirm('Remover este t√≥pico?'))return;
  const topicos=await getTopicos(); topicos.splice(i,1);
  await saveTopicos(topicos); renderAdmTopicos(); renderTopicosPublic(topicos);
};

window.moveTopico=async function(i,dir){
  const topicos=await getTopicos();
  const j=i+dir; if(j<0||j>=topicos.length)return;
  [topicos[i],topicos[j]]=[topicos[j],topicos[i]];
  await saveTopicos(topicos); renderAdmTopicos(); renderTopicosPublic(topicos);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INICIALIZA√á√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
await loadSiteData();
getTopicos().then(renderTopicosPublic);
updateNavUser();
renderCForm();

</script>
</body>
</html>
